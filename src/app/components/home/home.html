<mat-sidenav-container class="dashboard-container">
  
  <mat-sidenav #sidenav 
               [mode]="isMobile ? 'over' : 'side'" 
               [opened]="!isMobile"
               class="app-sidebar">
    
    <div class="sidebar-header">
      <div class="logo-box">
        <mat-icon>gesture</mat-icon>
      </div>
      <div class="app-name">MyWhiteboard</div>
    </div>
    
    <mat-nav-list class="nav-menu">
      
      <a mat-list-item (click)="seccionActual = 'MIS_SALAS'; isMobile ? sidenav.close() : null" 
         [class.active-link]="seccionActual === 'MIS_SALAS'">
        <mat-icon matListItemIcon>dashboard</mat-icon> 
        <span matListItemTitle>Mis Pizarras</span>
      </a>

      <a mat-list-item (click)="seccionActual = 'MIS_NOTAS'; isMobile ? sidenav.close() : null" 
         [class.active-link]="seccionActual === 'MIS_NOTAS'">
        <mat-icon matListItemIcon>library_books</mat-icon> 
        <span matListItemTitle>Mis Notas</span>
      </a>
      
      <a mat-list-item (click)="seccionActual = 'COMPARTIDAS'; isMobile ? sidenav.close() : null" 
         [class.active-link]="seccionActual === 'COMPARTIDAS'">
        <mat-icon matListItemIcon>group</mat-icon> 
        <span matListItemTitle>Compartidas</span>
      </a>

    </mat-nav-list>

    <div class="sidebar-footer">
      <div class="user-info">
        <mat-icon>account_circle</mat-icon>
        <span>{{ usuarioActual }}</span>
      </div>
      <button mat-button class="btn-logout" (click)="logout()">
        <mat-icon>logout</mat-icon> Salir
      </button>
    </div>
  </mat-sidenav>

  <mat-sidenav-content class="main-content">
    
    <div class="mobile-toolbar" *ngIf="isMobile">
      <button mat-icon-button (click)="sidenav.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
      <span class="mobile-title">MyWhiteboard</span>
    </div>

    <div *ngIf="seccionActual === 'MIS_SALAS'" class="fade-in content-wrapper">
      <header class="content-header">
        <h1>Tus Espacios</h1>
        <p>Crea, dibuja y organiza tus ideas en lienzos infinitos.</p>
      </header>

      <div class="create-bar">
        <mat-icon class="search-icon">add_circle_outline</mat-icon>
        <input type="text" placeholder="Nombre para una nueva pizarra..." 
               [(ngModel)]="nuevoNombre" (keyup.enter)="crearSala()">
        <button mat-flat-button color="primary" (click)="crearSala()" [disabled]="!nuevoNombre">
          Crear
        </button>
      </div>

      <div class="grid-layout">
        <div *ngFor="let sala of misSalas" class="apple-card">
          
          <div class="card-preview" (click)="irASala(sala.id)">
            <img [src]="sala.imagenFondo || 'https://placehold.co/600x400/fafafa/e0e0e0?text=Lienzo'" alt="Preview">
            <div class="overlay">
              <button mat-icon-button class="btn-icon-glass">
                <mat-icon>edit</mat-icon>
              </button>
            </div>
          </div>

          <div class="card-info" (click)="irASala(sala.id)">
            <div class="card-title">{{ sala.titulo }}</div>
            <div class="card-meta" style="font-size: 10px; color: #aaa;">ID: {{ sala.id }}</div> 
            
            <div class="card-actions">
              <button mat-icon-button matTooltip="Invitar" (click)="abrirInvitar(sala.id, $event)">
                <mat-icon>person_add</mat-icon>
              </button>
              <button mat-icon-button color="warn" matTooltip="Borrar" (click)="borrarSala(sala.id, $event)">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <div *ngIf="seccionActual === 'MIS_NOTAS'" class="fade-in" style="height: 100%; overflow: hidden;">
       <app-file-explorer></app-file-explorer>
    </div>

    <div *ngIf="seccionActual === 'COMPARTIDAS'" class="fade-in content-wrapper">
      <header class="content-header">
        <h1>Compartidos conmigo</h1>
        <p>Colabora en proyectos de equipo.</p>
      </header>

      <div class="grid-layout">
        <div *ngFor="let sala of salasCompartidas" class="apple-card shared" (click)="irASala(sala.id)">
          <div class="shared-badge">Colaboración</div>
          <div class="card-preview">
            <img [src]="sala.imagenFondo || 'https://placehold.co/600x400/fafafa/e0e0e0?text=Shared'" alt="Preview">
          </div>
          <div class="card-info">
            <div class="card-title">{{ sala.titulo }}</div>
            <div class="card-meta">Propietario: {{ sala.propietario }}</div>
          </div>
        </div>
      </div>

      <div *ngIf="salasCompartidas.length === 0" class="empty-state">
        <div class="empty-icon"><mat-icon>folder_open</mat-icon></div>
        <h3>Todo tranquilo por aquí</h3>
        <p>Aún no te han invitado a ninguna pizarra.</p>
      </div>
    </div>

  </mat-sidenav-content>
</mat-sidenav-container>